<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>SAT Math – Practice Exam (EN • HARDLOCK)</title>
  <!-- EN-HARDLOCK BUILD: All static UI is English-only. This page clears any saved customQuestions. -->
  <style>
    :root { --bg:#f6f7fb; --card:#fff; --muted:#6b7280; --border:#e5e7eb; --ink:#111827; }
    *{box-sizing:border-box}
    html,body{margin:0;padding:0;background:var(--bg);color:var(--ink);font-family:system-ui, Segoe UI, Arial}
    .wrap{max-width:1080px;margin:0 auto;padding:16px}
    .card{background:#fff;border:1px solid var(--border);border-radius:16px;box-shadow:0 10px 30px rgba(0,0,0,.05);padding:16px;margin-top:12px}
    .header{display:flex;justify-content:space-between;align-items:center}
    .timer{background:#f1f5f9;border-radius:10px;padding:6px 10px;font-weight:800;min-width:110px;text-align:center}
    .modules{display:flex;gap:8px;flex-wrap:wrap;margin:8px 0}
    .mod{border:1px solid var(--border);border-radius:12px;padding:8px 12px;background:#fff;font-weight:600}
    .mod.active{background:#111827;color:#fff}
    .qbox{border:1px solid var(--border);border-radius:12px;padding:16px;background:#fafafa}
    .choices{display:grid;gap:10px;margin-top:12px}
    .choice{display:flex;gap:8px;align-items:center;border:1px solid var(--border);border-radius:12px;padding:10px;background:#fff}
    .controls{display:flex;justify-content:space-between;align-items:center;gap:8px;margin-top:12px;flex-wrap:wrap}
    .btn{border:none;border-radius:12px;padding:10px 14px;cursor:pointer;font-weight:700;background:#111827;color:#fff}
    .btn.secondary{background:#e5e7eb;color:#111827}
    input[type=text],input[type=email]{width:100%;padding:10px;border:1px solid var(--border);border-radius:10px}
    .grid{display:grid;grid-template-columns:1fr 1fr;gap:10px}
    .muted{color:#6b7280}
  </style>
  <script>
    // HARDLOCK: ensure English-only by wiping any previously saved question bank that could override UI
    try { localStorage.removeItem('customQuestions'); } catch(e) {}
    document.addEventListener('DOMContentLoaded', ()=>{
      document.documentElement.lang = 'en';
      document.documentElement.dir = 'ltr';
    });
  </script>
</head>
<body>
  <div class="wrap">
    <div class="header">
      <div>
        <h1>SAT Math – Practice Exam (EN • HARDLOCK)</h1>
        <div class="muted">2 Modules × 22 Questions = 44 Questions • Total time: 70 minutes</div>
      </div>
      <div id="timer" class="timer">70:00</div>
    </div>

    <div id="modulesBar" class="modules"></div>

    <div class="card">
      <div id="startScreen">
        <h2>Student Information</h2>
        <p class="muted">Include country code with phone (e.g., +974 55xxxxxx).</p>
        <div class="grid">
          <div style="grid-column:1/-1"><label>Full Name</label><input id="studentName" type="text" placeholder="Your full name"/></div>
          <div><label>Email</label><input id="studentEmail" type="email" placeholder="name@example.com"/></div>
          <div><label>Phone</label><input id="studentPhone" type="text" placeholder="+974 55xxxxxx"/></div>
        </div>
        <div style="display:flex;justify-content:space-between;align-items:center;margin-top:8px">
          <p class="muted">Click <b>Start Exam</b> to begin the 70:00 countdown.</p>
          <button class="btn" id="startBtn">Start Exam</button>
        </div>
      </div>

      <div id="examContent" style="display:none">
        <div id="questionBox" class="qbox"></div>
        <div class="controls">
          <div>
            <button class="btn secondary" id="prevBtn">Previous</button>
            <button class="btn secondary" id="nextBtn">Next</button>
          </div>
          <div id="progressText" class="muted">Module 1 • Question 1 of 22</div>
          <button class="btn" id="submitBtn">Finish Exam</button>
        </div>
      </div>
    </div>
  </div>

  <script>
    // Load Module 1 from module1.json. Module 2 starts empty.
    async function loadExam(){
      const r = await fetch('module1.json', { cache: 'no-store' });
      const m1 = r.ok ? await r.json() : [];
      return { modules:[ {name:'Module 1', questions:m1}, {name:'Module 2', questions:[]} ], totalDurationMinutes:70 };
    }
    function fmtTime(s){ const m=Math.floor(s/60),x=s%60; return `${String(m).padStart(2,'0')}:${String(x).padStart(2,'0')}`; }
    function parseNumber(v){ if(v==null) return null; const t=String(v).replace(/,/g,'.').trim(); if(!t) return null; const n=Number(t); return Number.isFinite(n)?n:null; }

    let exam, started=false, review=false, curM=0, curQ=0, remain=0, userAns=[], timeSpent=[], last=null;
    const modulesBar=document.getElementById('modulesBar');
    const qbox=document.getElementById('questionBox');
    const timerEl=document.getElementById('timer');
    const progress=document.getElementById('progressText');

    function renderModules(){ modulesBar.innerHTML=''; exam.modules.forEach((m,i)=>{ const b=document.createElement('button'); b.className='mod'+(i===curM?' active':''); b.textContent=`${m.name} (${m.questions.length} Qs)`; b.disabled=!started; b.onclick=()=>{ if(!review) nav(i, Math.min(curQ, m.questions.length-1)); }; modulesBar.appendChild(b); }); }
    function nav(mi,qi){ if(started&&!review&&last){ const now=Date.now(); timeSpent[curM][curQ]+=Math.max(0,Math.round((now-last)/1000)); last=now; } curM=mi; curQ=qi; renderQ(); }

    function renderQ(){ renderModules(); const mod=exam.modules[curM]; const q=mod.questions[curQ]; if(!q){ qbox.innerHTML='<div class="muted">No questions.</div>'; return; }
      let html = `<div style='display:flex;justify-content:space-between;align-items:center'><h3>${mod.name} – Question ${curQ+1}</h3><span class='muted'>${q.type==='mcq'?'Multiple Choice':'Numeric'}</span></div>`;
      html += `<div style='margin-top:8px;font-size:18px'>${q.text||''}</div>`;
      if(q.type==='mcq'){
        html += `<div class='choices' id='choices'></div>`;
      } else {
        const val = userAns[curM][curQ];
        html += `<div style='margin-top:12px;display:flex;gap:10px;align-items:center'><input id='numInput' type='text' inputmode='decimal' placeholder='Enter a number...' value='${val??''}' style='padding:10px;border:1px solid #e5e7eb;border-radius:10px;width:240px'><span class='muted'>Use '.' or ','</span></div>`;
      }
      qbox.innerHTML=html;
      if(q.type==='mcq'){
        const box=document.getElementById('choices');
        (q.choices||[]).forEach((t,i)=>{ const L=document.createElement('label'); L.className='choice'; L.innerHTML = `<input type='radio' name='q${curM}-${curQ}' value='${i}' ${userAns[curM][curQ]===i?'checked':''}/> <span>${t}</span>`; L.addEventListener('change',e=>{ userAns[curM][curQ]=Number(e.target.value); }); box.appendChild(L); });
      } else {
        const inp=document.getElementById('numInput'); inp.addEventListener('input', e=>{ userAns[curM][curQ]=parseNumber(e.target.value); });
      }
      const totalQ = exam.modules.reduce((s,m)=>s+m.questions.length,0);
      const before = exam.modules.slice(0,curM).reduce((s,m)=>s+m.questions.length,0);
      progress.textContent = `${exam.modules[curM].name} • Question ${curQ+1} of ${exam.modules[curM].questions.length} (Overall ${before+curQ+1} of ${totalQ})`;
      document.getElementById('prevBtn').disabled = (curM===0 && curQ===0);
      document.getElementById('nextBtn').disabled = (curM===exam.modules.length-1 && curQ===exam.modules[curM].questions.length-1);
      last = Date.now();
    }

    function startTimer(){ timerEl.textContent=fmtTime(remain); const id=setInterval(()=>{ remain--; timerEl.textContent=fmtTime(Math.max(0,remain)); if(remain<=0){ clearInterval(id); if(!review){ alert('Time is up!'); finish(); } } },1000); }
    function finish(){ review=true; document.getElementById('submitBtn').disabled=true; qbox.innerHTML = `<div class='muted'><b>Thank you!</b> Your responses have been recorded.</div>`; }

    document.getElementById('startBtn').addEventListener('click',()=>{
      const name=document.getElementById('studentName').value.trim(), email=document.getElementById('studentEmail').value.trim(), phone=document.getElementById('studentPhone').value.trim();
      if(!name||name.length<2) return alert('Please enter full name.');
      if(!/^\S+@\S+\.\S+$/.test(email)) return alert('Please enter a valid email.');
      if(phone.replace(/\D/g,'').length<7) return alert('Please enter valid phone');
      started=true; document.getElementById('startScreen').style.display='none'; document.getElementById('examContent').style.display='block';
      renderQ(); startTimer();
    });

    document.getElementById('prevBtn').addEventListener('click',()=>{ if(curQ>0) nav(curM,curQ-1); else if(curM>0){ const pm=curM-1; nav(pm, exam.modules[pm].questions.length-1); } });
    document.getElementById('nextBtn').addEventListener('click',()=>{ const mod=exam.modules[curM]; if(curQ<mod.questions.length-1) nav(curM,curQ+1); else if(curM<exam.modules.length-1) nav(curM+1,0); });

    (async function(){
      exam = await loadExam();
      remain = (exam.totalDurationMinutes||70)*60;
      userAns = exam.modules.map(m=>m.questions.map(()=>null));
      timeSpent = exam.modules.map(m=>m.questions.map(()=>0));
      modulesBar.textContent='';
      exam.modules.forEach((m,i)=>{ const b=document.createElement('button'); b.className='mod'+(i===0?' active':''); b.textContent=`${m.name} (${m.questions.length} Qs)`; b.disabled=true; modulesBar.appendChild(b); });
    })();
  </script>
</body>
</html>