<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Master Admin - TALAL.TEK</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        :root { --primary: #3498db; --secondary: #2ecc71; --accent: #9b59b6; --money: #f39c12; --danger: #e74c3c; --dark: #1e293b; --bg: #f1f5f9; }
        body { font-family: 'Segoe UI', sans-serif; background: var(--bg); margin: 0; display: flex; }
        
        /* Sidebar */
        .sidebar { width: 260px; background: var(--dark); color: white; height: 100vh; position: fixed; padding: 20px 0; }
        .sidebar-header { padding: 0 20px 30px; border-bottom: 1px solid #334155; margin-bottom: 20px; text-align: center; }
        .nav-item { padding: 15px 25px; cursor: pointer; transition: 0.3s; display: flex; align-items: center; gap: 12px; color: #94a3b8; }
        .nav-item:hover, .nav-item.active { background: #334155; color: white; border-right: 4px solid var(--primary); }

        /* Content Area */
        .main-content { margin-left: 260px; padding: 40px; width: calc(100% - 280px); box-sizing: border-box; }
        .card { background: white; padding: 25px; border-radius: 15px; box-shadow: 0 5px 15px rgba(0,0,0,0.05); margin-bottom: 25px; border: 1px solid #e2e8f0; }
        
        h3 { margin-top: 0; color: var(--dark); border-bottom: 2px solid #f1f5f9; padding-bottom: 10px; margin-bottom: 20px; }

        .form-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 15px; }
        .form-group { margin-bottom: 15px; text-align: left; }
        label { display: block; margin-bottom: 5px; font-weight: bold; color: #475569; font-size: 0.9rem; }
        input, select, textarea { width: 100%; padding: 12px; border: 1px solid #cbd5e1; border-radius: 10px; box-sizing: border-box; font-size: 1rem; }
        
        .btn { border: none; padding: 15px; border-radius: 10px; cursor: pointer; font-weight: bold; transition: 0.3s; color: white; }
        .btn-blue { background: var(--primary); }
        .btn-green { background: var(--secondary); }
        .btn-purple { background: var(--accent); }
        
        /* Tables */
        .data-table { width: 100%; border-collapse: collapse; margin-top: 15px; }
        .data-table th { background: #f8fafc; padding: 12px; text-align: left; border-bottom: 2px solid #e2e8f0; color: #64748b; }
        .data-table td { padding: 12px; border-bottom: 1px solid #f1f5f9; }
        
        .badge { padding: 5px 10px; border-radius: 6px; font-size: 0.75rem; font-weight: bold; }
        .hidden { display: none; }

        /* Financial Empty State */
        .financial-placeholder { text-align: center; padding: 60px 20px; color: #94a3b8; }
        .financial-placeholder i { font-size: 5rem; color: #e2e8f0; margin-bottom: 20px; }
    </style>
</head>
<body>

<div class="sidebar">
    <div class="sidebar-header">
        <h2 style="color:var(--primary)">TALAL.TEK</h2>
        <small>Control Center v2.0</small>
    </div>
    <div class="nav-item active" onclick="showSection('videoSec')"><i class="fas fa-video"></i> Lessons & Videos</div>
    <div class="nav-item" onclick="showSection('unitQSec')"><i class="fas fa-edit"></i> Unit Quizzes</div>
    <div class="nav-item" onclick="showSection('finalExamSec')"><i class="fas fa-file-invoice"></i> Final Exams</div>
    <div class="nav-item" onclick="showSection('studentSec')"><i class="fas fa-users"></i> Student Database</div>
    <div class="nav-item" style="color: var(--money);" onclick="showSection('financeSec')"><i class="fas fa-file-invoice-dollar"></i> Financial & Access</div>
</div>

<div class="main-content">

    <div id="videoSec" class="card section">
        <h3><i class="fas fa-plus-circle"></i> Add New Video Lesson</h3>
        <div class="form-grid">
            <div class="form-group"><label>Unit Number</label><input type="text" id="vUnit" placeholder="e.g. Unit 1"></div>
            <div class="form-group"><label>Lesson Title</label><input type="text" id="vTitle" placeholder="e.g. Slopes & Intercepts"></div>
        </div>
        <div class="form-group"><label>YouTube Embed Link</label><input type="text" id="vUrl" placeholder="https://www.youtube.com/embed/XXXXXX"></div>
        <button class="btn btn-blue" onclick="saveItem('video')">Add Lesson to Course</button>
    </div>

    <div id="unitQSec" class="card section hidden">
        <h3><i class="fas fa-pen-alt"></i> Add Unit Practice Question</h3>
        <div class="form-grid">
            <div class="form-group"><label>Select Unit</label><select id="uTarget"><option>Unit 1</option><option>Unit 2</option><option>Unit 3</option></select></div>
            <div class="form-group"><label>Question Type</label><select id="uType" onchange="toggleInputs('u')"><option value="mcq">Multiple Choice</option><option value="gridin">Grid-in</option></select></div>
        </div>
        <div class="form-group"><label>Question Text (LaTeX Support)</label><textarea id="uText" rows="2"></textarea></div>
        <div class="form-group"><label>Diagram/Image URL (Optional)</label><input type="text" id="uImg" placeholder="Link to image..."></div>
        <div id="uMcqArea" class="form-grid"><input type="text" id="uA" placeholder="Opt A"><input type="text" id="uB" placeholder="Opt B"><input type="text" id="uC" placeholder="Opt C"><input type="text" id="uD" placeholder="Opt D"></div>
        <div id="uGridArea" class="form-group hidden"><label>Correct Answer</label><input type="text" id="uCorrect" placeholder="Exact value"></div>
        <button class="btn btn-green" onclick="saveItem('unitQ')">Save Unit Question</button>
    </div>

    <div id="finalExamSec" class="card section hidden">
        <h3><i class="fas fa-trophy"></i> Add Final Mock Exam Question</h3>
        <div class="form-group"><label>Exam Set Name / Duration</label><input type="text" id="fSet" placeholder="e.g. Mock Exam 2024 / 60 mins"></div>
        <div class="form-group"><label>Question Type</label><select id="fType" onchange="toggleInputs('f')"><option value="mcq">Multiple Choice</option><option value="gridin">Grid-in</option></select></div>
        <div class="form-group"><label>Question Text</label><textarea id="fText" rows="2"></textarea></div>
        <div id="fMcqArea" class="form-grid"><input type="text" id="fA" placeholder="Opt A"><input type="text" id="fB" placeholder="Opt B"><input type="text" id="fC" placeholder="Opt C"><input type="text" id="fD" placeholder="Opt D"></div>
        <div id="fGridArea" class="form-group hidden"><label>Correct Answer</label><input type="text" id="fCorrect"></div>
        <button class="btn btn-purple" onclick="saveItem('finalQ')">Add to Final Bank</button>
    </div>

    <div id="studentSec" class="card section hidden">
        <h3><i class="fas fa-user-friends"></i> Registered Students</h3>
        <table class="data-table">
            <thead><tr><th>Name</th><th>Email</th><th>Status</th><th>Action</th></tr></thead>
            <tbody id="studentTable"></tbody>
        </table>
    </div>

    <div id="financeSec" class="card section hidden">
        <h3><i class="fas fa-wallet"></i> Financial & Payments Management</h3>
        <div class="financial-placeholder">
            <i class="fas fa-lock"></i>
            <h2>Reserved for Financial Module</h2>
            <p>هذا القسم سيسمح لك بمراجعة عمليات الدفع، تفعيل اشتراكات الطلاب يدوياً، وإدارة الفواتير.</p>
            <div style="margin-top: 20px; color: #3498db; font-weight: bold;">[ Under Development ]</div>
        </div>
    </div>

    <div class="card" id="inventoryCard">
        <h3><i class="fas fa-database"></i> Content Inventory</h3>
        <table class="data-table">
            <thead><tr><th>Type</th><th>Unit/Set</th><th>Content Preview</th><th>Action</th></tr></thead>
            <tbody id="contentTable"></tbody>
        </table>
    </div>

</div>

<script>
    function showSection(id) {
        document.querySelectorAll('.section').forEach(s => s.classList.add('hidden'));
        document.getElementById(id).classList.remove('hidden');
        
        // إخفاء جدول المحتوى فقط عند فتح قسم الطلاب أو المالية لزيادة التركيز
        const inv = document.getElementById('inventoryCard');
        inv.style.display = (id === 'studentSec' || id === 'financeSec') ? 'none' : 'block';
        
        document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
        event.currentTarget.classList.add('active');
        
        if(id === 'studentSec') renderStudents();
    }

    function toggleInputs(p) {
        const isMcq = document.getElementById(p+'Type').value === 'mcq';
        document.getElementById(p+'McqArea').classList.toggle('hidden', !isMcq);
        document.getElementById(p+'GridArea').classList.toggle('hidden', isMcq);
    }

    function saveItem(type) {
        let key = ''; let data = { id: Date.now(), type: type };
        
        if(type === 'video') {
            key = 'added_lessons';
            data.unitNum = document.getElementById('vUnit').value;
            data.title = document.getElementById('vTitle').value;
            data.videoURL = document.getElementById('vUrl').value;
        } else if(type === 'unitQ' || type === 'finalQ') {
            key = (type === 'unitQ') ? 'added_questions' : 'final_exam_questions';
            const p = (type === 'unitQ') ? 'u' : 'f';
            data.qType = document.getElementById(p+'Type').value;
            data.text = document.getElementById(p+'Text').value;
            data.img = (type === 'unitQ') ? document.getElementById('uImg').value : '';
            data.unit = (type === 'unitQ') ? document.getElementById('uTarget').value : document.getElementById('fSet').value;
            if(data.qType === 'mcq') {
                data.options = [document.getElementById(p+'A').value, document.getElementById(p+'B').value, document.getElementById(p+'C').value, document.getElementById(p+'D').value];
            } else { data.correct = document.getElementById(p+'Correct').value; }
        }

        let db = JSON.parse(localStorage.getItem(key) || '[]');
        db.push(data);
        localStorage.setItem(key, JSON.stringify(db));
        alert("Data Saved Successfully!");
        renderContent();
    }

    function renderContent() {
        const body = document.getElementById('contentTable'); body.innerHTML = '';
        const keys = ['added_lessons', 'added_questions', 'final_exam_questions'];
        keys.forEach(key => {
            const items = JSON.parse(localStorage.getItem(key) || '[]');
            items.forEach(item => {
                body.innerHTML += `<tr>
                    <td><span class="badge" style="background:#eee">${item.type.toUpperCase()}</span></td>
                    <td>${item.unitNum || item.unit}</td>
                    <td>${(item.title || item.text).substring(0,30)}...</td>
                    <td><button onclick="deleteItem('${key}', ${item.id})" style="color:red; border:none; background:none; cursor:pointer;"><i class="fas fa-trash"></i></button></td>
                </tr>`;
            });
        });
    }

    function renderStudents() {
        const users = JSON.parse(localStorage.getItem('users') || '[]');
        const body = document.getElementById('studentTable'); body.innerHTML = '';
        users.forEach(u => {
            body.innerHTML += `<tr>
                <td>${u.name}</td><td>${u.email}</td>
                <td><span class="badge" style="background:#dcfce7">Active</span></td>
                <td><button onclick="deleteStudent('${u.email}')" style="color:red; border:none; background:none; cursor:pointer;">Remove</button></td>
            </tr>`;
        });
    }

    function deleteItem(key, id) {
        let db = JSON.parse(localStorage.getItem(key)).filter(i => i.id !== id);
        localStorage.setItem(key, JSON.stringify(db)); renderContent();
    }

    function deleteStudent(email) {
        let db = JSON.parse(localStorage.getItem('users')).filter(u => u.email !== email);
        localStorage.setItem('users', JSON.stringify(db)); renderStudents();
    }

    window.onload = renderContent;
</script>
</body>
</html>
